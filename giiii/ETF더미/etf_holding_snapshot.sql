-- ETF Holding Snapshot 업데이트 (2025-02-03 거래 반영 후)
-- 계좌 ID 6의 ETF 보유 현황 스냅샷

DELETE FROM etf_holding_snapshot WHERE isa_account_id = 6;

INSERT INTO etf_holding_snapshot (isa_account_id, etf_id, snapshot_date, evaluated_amount, profit)
VALUES

-- 이전 월별 스냅샷 (참고용 - 1월 말 기준)
(6, 1, '2025-01-31 23:59:59', 266420.00, -14140.00),   -- ETF ID 1: 28주 @ 10,020원
(6, 26, '2025-01-31 23:59:59', 883710.00, 19440),  -- ETF ID 26: 27주 @ 32,010원
(6, 40, '2025-01-31 23:59:59', 1067040.00, 35160), -- ETF ID 40: 32주 @ 32,215원
(6, 318, '2025-01-31 23:59:59', 228580.00, 6490), -- ETF ID 318: 22주 @ 10,095원
(6, 353, '2025-01-31 23:59:59', 573300.00, 63630) -- ETF ID 353: 42주 @ 12,135원
;

-- 2월 말 스냅샷
INSERT INTO etf_holding_snapshot (isa_account_id, etf_id, snapshot_date, evaluated_amount, profit)
VALUES
(6, 1, '2025-02-28 23:59:59', 403555.00, -17780.00),     -- ETF ID 1: 28주 × (9385-10020) =  -17780원
(6, 26, '2025-02-28 23:59:59', 571370.00, 27200.00),   -- ETF ID 26: 17주 × (33610-32010) = +27200원 (매도 10주 제외)
(6, 40, '2025-02-28 23:59:59', 1777880.00, 63200.00),  -- ETF ID 40: 32주 × (34190-32215) = +63200원
(6, 318, '2025-02-28 23:59:59', 149450.00, 8120.00),   -- ETF ID 318: 14주 × (10675-10095) = +8120원 (매도 8주 제외)
(6, 353, '2025-02-28 23:59:59', 907410.00, 48090.00)  -- ETF ID 353: 42주 × (13280-12135) = +48090원
;

-- ==============================================
-- 3월 말 스냅샷 (3월 거래내역 반영 후)
-- ==============================================
INSERT INTO etf_holding_snapshot (isa_account_id, etf_id, snapshot_date, evaluated_amount, profit)
VALUES
-- 3월 거래 후 보유 현황 기준 (기존 보유분에 대한 평가손익 포함)
(6, 1, '2025-03-31 23:59:59', 557680.00, -2770.00),  -- ETF ID 1: 기존 43주 profit = 43 × (9,620-9,684.42) = -2,770원
(6, 26, '2025-03-31 23:59:59', 224070.00, 0.00),     -- ETF ID 26: 남은 7주 profit = 7 × (32,010-32,010) = 0원
(6, 40, '2025-03-31 23:59:59', 1039360.00, 6.00),    -- ETF ID 40: 남은 32주 profit = 32 × (32,480-32,479.81) = 6원
(6, 318, '2025-03-31 23:59:59', 149450.00, 8120.00), -- ETF ID 318: 14주 profit = 14 × (10,675-10,095) = 8,120원 (거래없음)
(6, 353, '2025-03-31 23:59:59', 1040860.00, 4131.00) -- ETF ID 353: 기존 67주 profit = 67 × (12,693-12,631.34) = 4,131원
;

-- 3월 거래내역 상세:
-- ETF ID 1: BUY 15주 @ 9,390원 → 총 58주 (43+15)
-- ETF ID 26: SELL 10주 @ 33,904원 → 총 7주 (17-10)  
-- ETF ID 40: SELL 20주 @ 34,210원 → 총 32주 (52-20)
-- ETF ID 353: BUY 15주 @ 12,970원 → 총 82주 (67+15)

-- ==============================================
-- 4월 말 스냅샷 (4월 거래내역 반영 후)
-- ==============================================
INSERT INTO etf_holding_snapshot (isa_account_id, etf_id, snapshot_date, evaluated_amount, profit)
VALUES
-- 4월 거래 후 보유 현황 기준 (4월 실제 시장가격 기준 평가손익)
(6, 1, '2025-04-30 23:59:59', 515620.00, -41661.00),     -- ETF ID 1: 58주 @ 8,890원 (평균가 9,608.28원)
(6, 26, '2025-04-30 23:59:59', 237370.00, 13300.00),     -- ETF ID 26: 7주 @ 33,910원 (평균가 32,010원)
(6, 40, '2025-04-30 23:59:59', 1091680.00, 52326.00),    -- ETF ID 40: 32주 @ 34,115원 (평균가 32,479.81원)
(6, 197, '2025-04-30 23:59:59', 1095500.00, 83000.00),   -- ETF ID 197: 25주 @ 43,820원 (평균가 40,500원) (신규)
(6, 295, '2025-04-30 23:59:59', 385350.00, -7350.00),    -- ETF ID 295: 30주 @ 12,845원 (평균가 13,090원) (신규)
(6, 318, '2025-04-30 23:59:59', 172690.00, 31360.00),    -- ETF ID 318: 14주 @ 12,335원 (평균가 10,095원)
(6, 353, '2025-04-30 23:59:59', 882720.00, -31197.00);   -- ETF ID 353: 72주 @ 12,260원 (평균가 12,693.29원)

-- 4월 거래내역 상세:
-- ETF ID 197: BUY 25주 @ 40,500원 (신규 매수)
-- ETF ID 295: BUY 30주 @ 13,090원 (신규 매수)  
-- ETF ID 353: SELL 10주 @ 13,320원 → 총 72주 (82-10)

-- 4월 말 기준 총 보유 현황:
-- ETF ID 1: 8890 * 58
-- ETF ID 26: 33910 * 7
-- ETF ID 40: 34115 * 32
-- ETF ID 197: 43820 * 25
-- ETF ID 295: 12845 * 30
-- ETF ID 318: 12335 * 14
-- ETF ID 353: 12260 * 72

-- 5월 말 기준 총 보유 현황 : 
-- ETF ID 1: 8935 * 58
-- ETF ID 26: 36140 * 7
-- ETF ID 40: 36340 * 32
-- ETF ID 197: 48165 * 25
-- ETF ID 295: 12570 * 30
-- ETF ID 318: 11715 * 14
-- ETF ID 353: 12915 * 72

-- ==============================================
-- 5월 말 스냅샷 (5월 거래내역 반영 후)
-- ==============================================
INSERT INTO etf_holding_snapshot (isa_account_id, etf_id, snapshot_date, evaluated_amount, profit)
VALUES
-- 5월 거래 후 보유 현황 기준 (5월 말 실제 시장가격 기준 평가손익)
(6, 1, '2025-05-31 23:59:59', 518230.00, -39030.00),     -- ETF ID 1: 58주 @ 8,935원 (평균가 9,608.28원)
(6, 26, '2025-05-31 23:59:59', 614380.00, 46001.00),     -- ETF ID 26: 17주 @ 36,140원 (평균가 33,434.12원)
(6, 40, '2025-05-31 23:59:59', 1162880.00, 123525.00),   -- ETF ID 40: 32주 @ 36,340원 (평균가 32,479.81원)
(6, 197, '2025-05-31 23:59:59', 481650.00, 76650.00),    -- ETF ID 197: 10주 @ 48,165원 (평균가 40,500원)
(6, 295, '2025-05-31 23:59:59', 251400.00, -10400.00),   -- ETF ID 295: 20주 @ 12,570원 (평균가 13,090원)
(6, 318, '2025-05-31 23:59:59', 164010.00, 22680.00),    -- ETF ID 318: 14주 @ 11,715원 (평균가 10,095원)
(6, 353, '2025-05-31 23:59:59', 1059030.00, 17511.00);   -- ETF ID 353: 82주 @ 12,915원 (평균가 12,701.46원)

-- 5월 거래내역 상세:
-- ETF ID 26: BUY 10주 @ 34,440원 → 총 17주 (7+10)
-- ETF ID 197: SELL 15주 @ 47,812원 → 총 10주 (25-15)
-- ETF ID 295: SELL 10주 @ 13,125원 → 총 20주 (30-10)
-- ETF ID 353: BUY 10주 @ 12,760원 → 총 82주 (72+10)

-- 5월 말 기준 총 보유 현황:
-- ETF ID 1: 58주 @ 평균가 9,608.28원
-- ETF ID 26: 17주 @ 평균가 33,434.12원
-- ETF ID 40: 32주 @ 평균가 32,479.81원  
-- ETF ID 197: 10주 @ 평균가 40,500원
-- ETF ID 295: 20주 @ 평균가 13,090원
-- ETF ID 318: 14주 @ 평균가 10,095원
-- ETF ID 353: 82주 @ 평균가 12,701.46원

-- ==============================================
-- 6월 말 스냅샷 (6월 거래내역 반영 후)
-- ==============================================
INSERT INTO etf_holding_snapshot (isa_account_id, etf_id, snapshot_date, evaluated_amount, profit)
VALUES
-- 6월 거래 후 보유 현황 기준 (6월 말 시장가격 기준 평가손익)
(6, 1, '2025-06-30 23:59:59', 612000.00, -23632.00),     -- ETF ID 1: 68주 @ 9,000원 (평균가 9,497.47원)
(6, 26, '2025-06-30 23:59:59', 1800000.00, 125263.00),   -- ETF ID 26: 45주 @ 40,000원 (평균가 37,449.76원)
(6, 40, '2025-06-30 23:59:59', 1120000.00, 80646.00),    -- ETF ID 40: 32주 @ 35,000원 (평균가 32,479.81원)
(6, 197, '2025-06-30 23:59:59', 202500.00, 0.00),        -- ETF ID 197: 5주 @ 40,500원 (평균가 40,500원)
(6, 295, '2025-06-30 23:59:59', 130000.00, -910.00),     -- ETF ID 295: 10주 @ 13,000원 (평균가 13,090원)
(6, 353, '2025-06-30 23:59:59', 1196800.00, -15494.00);  -- ETF ID 353: 92주 @ 13,000원 (평균가 12,831.24원)

-- 6월 거래내역 상세:
-- ETF ID 1: BUY 10주 @ 8,855원 → 총 68주 (58+10)
-- ETF ID 26: BUY 28주 @ 39,640원 → 총 45주 (17+28)
-- ETF ID 197: SELL 5주 @ 49,915원 → 총 5주 (10-5)
-- ETF ID 295: SELL 10주 @ 13,125원 → 총 10주 (20-10)
-- ETF ID 318: SELL 14주 @ 12,500원 → 총 0주 (전량 매도)
-- ETF ID 353: BUY 10주 @ 13,900원 → 총 92주 (82+10)

-- 6월 말 기준 총 보유 현황:
-- ETF ID 1: 68주 @ 평균가 9,497.47원
-- ETF ID 26: 45주 @ 평균가 37,449.76원
-- ETF ID 40: 32주 @ 평균가 32,479.81원  
-- ETF ID 197: 5주 @ 평균가 40,500원
-- ETF ID 295: 10주 @ 평균가 13,090원
-- ETF ID 353: 92주 @ 평균가 12,831.24원
-- ETF ID 318: 포지션 종료 (전량 매도)
